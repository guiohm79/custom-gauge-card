!function(){"use strict";const t={default:{background:"#222",gaugeBackground:"radial-gradient(circle, #444, #222)",centerBackground:"radial-gradient(circle, #333, #111)",textColor:"white",secondaryTextColor:"#ddd"},light:{background:"#f0f0f0",gaugeBackground:"radial-gradient(circle, #e0e0e0, #d0d0d0)",centerBackground:"radial-gradient(circle, #f5f5f5, #e5e5e5)",textColor:"#333",secondaryTextColor:"#666"},dark:{background:"#111",gaugeBackground:"radial-gradient(circle, #333, #111)",centerBackground:"radial-gradient(circle, #222, #000)",textColor:"#eee",secondaryTextColor:"#bbb"}};function e(t){return t?t.split(".")[0]:null}function n(t,e){const n=e||[{color:"#4caf50",value:20},{color:"#ffeb3b",value:50},{color:"#f44336",value:100}];for(const e of n)if(t<=e.value)return e.color;return"#555"}function o(t){const e=t._hass.states[t.config.entity];if(!e)return;const n=parseFloat(e?.state||"0"),o=null!==t.previousState?t.previousState:n,r=t.config.min||0,s=t.config.max||100;if(t.config.smooth_transitions&&o!==n)!function(t,e,n,o,i){const a=t.ledsCount||t.config.leds_count||100,r=(t.config.animation_duration||800)/20,s=n-e;t.animationInterval&&clearInterval(t.animationInterval);let c=0;t.animationInterval=setInterval(()=>{c++;const n=(r=c/20)<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2;var r;const l=e+s*n,d=(l-o)/(i-o)*100;t._updateLeds&&t._updateLeds(d,a),t._updateCenterShadow&&t._updateCenterShadow(d);const u=t.shadowRoot?.querySelector(".value");u&&(u.textContent=l.toFixed(t.config.decimals||0)),c>=20&&(clearInterval(t.animationInterval),t.animationInterval=null)},r)}(t,o,n,r,s);else{const e=(n-r)/(s-r)*100;i(t,e,t.ledsCount||t.config.leds_count||100),a(t,e);const o=t.shadowRoot.querySelector(".value"),c=t.shadowRoot.querySelector(".unit");o&&(o.textContent=n.toFixed(t.config.decimals||0)),c&&(c.textContent=t.config.unit||"")}t.previousState=n,t._updateButtonsState&&t._updateButtonsState()}function i(t,e,o){const i=Math.round(e/100*o),a=n(e,t.config.severity);if(t.config.enable_shadow){const e=t.shadowRoot.getElementById("gauge-container");e&&(e.style.boxShadow=`0 0 30px 2px ${a}`)}for(let e=0;e<o;e++){const n=t.shadowRoot.getElementById(`led-${e}`);n&&(e<i?(n.style.display="",n.style.background=`radial-gradient(circle, rgba(255, 255, 255, 0.8), ${a})`,n.style.boxShadow=`0 0 8px ${a}`,n.classList.add("active")):(t.config.hide_inactive_leds?n.style.display="none":(n.style.display="",n.style.background="#333",n.style.boxShadow="none"),n.classList.remove("active")))}}function a(t,e){if(!t.config.center_shadow)return;const o=n(e,t.config.severity),i=t.config.center_shadow_blur||30,a=t.config.center_shadow_spread||15,r=t.shadowRoot.getElementById("center-shadow");r&&(r.style.boxShadow=`0 0 ${i}px ${a}px ${o}`)}function r(t){if(!t._hass||!t.config.buttons||0===t.config.buttons.length)return;const n=t.shadowRoot.getElementById("gauge-container");n&&(t.config.buttons.forEach((o,i)=>{const a=o.entity;if(!a)return;if(!t._hass.states[a])return void console.warn(`Entity ${a} not found`);const r=`button-${i}`;let c=t.shadowRoot.getElementById(r);if(!c){const l=e(a),d=o.icon||{switch:"‚óè",light:"üí°",scene:"üé¨",script:"‚ñ∂",input_boolean:"‚óè",automation:"ü§ñ",fan:"üåÄ",cover:"ü™ü",climate:"üå°Ô∏è",lock:"üîí",vacuum:"ü§ñ"}[l]||"‚óè",u=o.position||"bottom-right",g=o.icon_size||t.config.button_icon_size;c=document.createElement("div"),c.id=r,c.className=`switch-button ${u}`,c.innerHTML=d,c.dataset.entity=a,c.dataset.index=i,o.icon_size&&c.style.setProperty("--icon-size",`${g}px`),c.addEventListener("click",n=>{n.stopPropagation(),function(t,n){if(!n||!t._hass)return;const o=t._hass.states[n];if(!o)return;const i=e(n),a=o.state;let r,c,l;switch(i){case"switch":case"light":case"input_boolean":case"fan":r=i,c="toggle",l={entity_id:n};break;case"automation":r="automation",c="toggle",l={entity_id:n};break;case"scene":r="scene",c="turn_on",l={entity_id:n};break;case"script":r="script",c="turn_on",l={entity_id:n};break;case"cover":r="cover",c="open"===a?"close_cover":"open_cover",l={entity_id:n};break;case"lock":r="lock",c="locked"===a?"unlock":"lock",l={entity_id:n};break;case"vacuum":r="vacuum",c="cleaning"===a?"stop":"start",l={entity_id:n};break;case"climate":r="climate",c="off"===a?"turn_on":"turn_off",l={entity_id:n};break;default:return void console.warn(`Entity type ${i} not supported for button control`)}t._hass.callService(r,c,l).then(()=>{setTimeout(()=>s(t),100)}).catch(t=>{console.error(`Error calling ${r}.${c}:`,t)})}(t,a)}),n.appendChild(c)}}),s(t))}function s(t){t._hass&&t.config.buttons&&0!==t.config.buttons.length&&t.config.buttons.forEach((e,n)=>{const o=e.entity,i=t.shadowRoot.getElementById(`button-${n}`);if(!i||!o)return;const a=t._hass.states[o];if(!a)return;const r=a.state,s=["on","open","unlocked","home","active"].includes(r);i.classList.remove("on","off"),i.classList.add(s?"on":"off");const c=a.attributes.friendly_name||o;i.title=`${c}: ${r.toUpperCase()}`})}class c extends HTMLElement{setConfig(e){this.config=function(t){if(!t.entity)throw new Error("Entit√© non d√©finie.");const e={...t,update_interval:t.update_interval||1e3,power_save_mode:t.power_save_mode||!1,power_save_threshold:t.power_save_threshold||10,debounce_updates:t.debounce_updates||!1,smooth_transitions:!1!==t.smooth_transitions,animation_duration:t.animation_duration||800,buttons:t.buttons||[],title_font_family:t.title_font_family||"inherit",title_font_size:t.title_font_size||"16px",title_font_weight:t.title_font_weight||"normal",title_font_color:t.title_font_color||null,value_font_family:t.value_font_family||"inherit",value_font_size:t.value_font_size||"32px",value_font_weight:t.value_font_weight||"bold",value_font_color:t.value_font_color||null,unit_font_size:t.unit_font_size||"16px",unit_font_weight:t.unit_font_weight||"normal",unit_font_color:t.unit_font_color||null,button_icon_size:t.button_icon_size||22,transparent_card_background:t.transparent_card_background||!1,transparent_gauge_background:t.transparent_gauge_background||!1,transparent_center_background:t.transparent_center_background||!1,hide_shadows:t.hide_shadows||!1,hide_inactive_leds:t.hide_inactive_leds||!1};return t.show_switch_button&&t.switch_entity&&0===e.buttons.length&&(e.buttons=[{entity:t.switch_entity,position:t.switch_button_position||"bottom-right",icon:null}]),e}(e),this.previousState=null,this.updateTimer=null,this.isVisible=!0,this.animationInterval=null,this.buttonsInitialized=!1,this.attachShadow({mode:"open"}),function(e){e.ledsCount=e.config.leds_count||100;const n=e.ledsCount,o=function(e,n){let o;return o="custom"===e?{background:n.custom_background||"#222",gaugeBackground:n.custom_gauge_background||"radial-gradient(circle, #444, #222)",centerBackground:n.custom_center_background||"radial-gradient(circle, #333, #111)",textColor:n.custom_text_color||"white",secondaryTextColor:n.custom_secondary_text_color||"#ddd"}:{...t[e]||t.default},n.transparent_card_background&&(o.background="transparent"),n.transparent_gauge_background&&(o.gaugeBackground="transparent"),n.transparent_center_background&&(o.centerBackground="transparent"),o}(e.config.theme||"default",e.config),i=e.config.gauge_size||200,a=e.config.led_size||8,r=function(t,e){const n=e.led_size||8,o=e.center_size||120,i=e.gauge_size||200,a=e.hide_shadows;return`\n    --card-background: ${t.background};\n    --gauge-background: ${t.gaugeBackground};\n    --center-background: ${t.centerBackground};\n    --text-color: ${t.textColor};\n    --secondary-text-color: ${t.secondaryTextColor};\n    --gauge-size: ${i}px;\n    --center-size: ${o}px;\n    --led-size: ${n}px;\n    --card-shadow: ${a?"none":"0 0 15px rgba(0, 0, 0, 0.5)"};\n    --led-shadow: ${a?"none":"0 0 4px rgba(0, 0, 0, 0.8)"};\n    --button-shadow: ${a?"none":"0 2px 8px rgba(0, 0, 0, 0.3)"};\n    --button-hover-shadow: ${a?"none":"0 4px 12px rgba(0, 0, 0, 0.5)"};\n    --value-font-size: ${e.value_font_size};\n    --value-font-family: ${e.value_font_family};\n    --value-font-weight: ${e.value_font_weight};\n    --value-font-color: ${e.value_font_color||t.textColor};\n    --unit-font-size: ${e.unit_font_size};\n    --unit-font-weight: ${e.unit_font_weight};\n    --unit-font-color: ${e.unit_font_color||t.secondaryTextColor};\n    --title-font-size: ${e.title_font_size};\n    --title-font-family: ${e.title_font_family};\n    --title-font-weight: ${e.title_font_weight};\n    --title-font-color: ${e.title_font_color||t.textColor};\n    --button-icon-size: ${e.button_icon_size}px;\n  `}(o,e.config),s=`\n    <style>\n      :host {\n        ${r}\n      }\n      .gauge-card{background:var(--card-background);border-radius:15px;box-shadow:var(--card-shadow);cursor:pointer;flex-direction:column;font-family:var(--ha-card-header-font-family,Arial),sans-serif;padding:16px;transition:box-shadow .3s ease-in-out}.gauge,.gauge-card{align-items:center;display:flex;justify-content:center;position:relative}.gauge{background:var(--gauge-background);border-radius:50%;height:var(--gauge-size);width:var(--gauge-size)}.center-shadow{background:radial-gradient(circle,transparent,transparent);box-shadow:none;height:var(--center-size);transition:box-shadow .3s ease-in-out;width:var(--center-size)}.center-shadow,.led{border-radius:50%;position:absolute}.led{background:#333;box-shadow:var(--led-shadow);height:var(--led-size);transition:background .2s ease,box-shadow .2s ease;width:var(--led-size)}.led.active{box-shadow:0 0 8px currentColor,inset 0 0 3px currentColor}.center{align-items:center;background:var(--center-background);border-radius:50%;color:var(--text-color);display:flex;flex-direction:column;height:var(--center-size);justify-content:center;position:absolute;text-align:center;text-shadow:0 1px 3px rgba(0,0,0,.5);width:var(--center-size)}.value{color:var(--value-font-color);font-family:var(--value-font-family);font-size:var(--value-font-size);font-weight:var(--value-font-weight);transition:all .3s ease}.unit{color:var(--unit-font-color);font-size:var(--unit-font-size);font-weight:var(--unit-font-weight)}.title{color:var(--title-font-color);font-family:var(--title-font-family);font-size:var(--title-font-size);font-weight:var(--title-font-weight);margin-top:10px;text-shadow:0 1px 3px rgba(0,0,0,.5)}.trend-indicator{align-items:center;background:rgba(0,0,0,.6);border-radius:12px;bottom:10px;color:#fff;display:flex;font-size:12px;gap:5px;padding:4px 8px;position:absolute;right:10px;z-index:5}.trend-arrow{font-size:14px;font-weight:700}.marker{background:#fff;border-radius:2px;box-shadow:0 0 5px rgba(0,0,0,.5);height:12px;width:4px}.marker,.marker-label{position:absolute;z-index:2}.marker-label{color:#fff;font-size:10px;text-shadow:0 0 3px rgba(0,0,0,.7)}.switch-button{align-items:center;border:2px solid hsla(0,0%,100%,.2);border-radius:50%;box-shadow:var(--button-shadow);cursor:pointer;display:flex;font-family:system-ui,-apple-system,Segoe UI,Segoe UI Emoji,Apple Color Emoji,sans-serif;font-size:var(--icon-size,var(--button-icon-size));font-weight:400;height:0;justify-content:center;line-height:1;position:absolute;transition:all .3s ease;width:0;z-index:3}.switch-button:hover{box-shadow:var(--button-hover-shadow);transform:scale(1.1)}.switch-button:active{transform:scale(.95)}.switch-button.on{background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;filter:brightness(1.2);opacity:1;text-shadow:0 0 10px #4caf50,0 0 20px rgba(76,175,80,.6)}.switch-button.off{background:linear-gradient(135deg,#666,#333);color:#333;filter:grayscale(.5);opacity:.4;text-shadow:none}.switch-button.top-left{left:30px;top:30px}.switch-button.top-right{right:30px;top:30px}.switch-button.bottom-left{bottom:40px;left:30px}.switch-button.bottom-right{bottom:40px;right:30px}\n    </style>\n    <div class="gauge-card" id="gauge-container">\n      <div class="gauge">\n        <div class="center-shadow" id="center-shadow"></div>\n        ${Array.from({length:n}).map((t,e)=>`<div class="led" id="led-${e}" style="transform: rotate(${e/n*360-90}deg) translate(${i/2-a}px);"></div>`).join("")}\n        <div class="center">\n          <div class="value">0</div>\n          <div class="unit"></div>\n        </div>\n      </div>\n      <div class="title">${e.config.name||""}</div>\n    </div>\n  `;e.shadowRoot.innerHTML=s}(this),this._updateGauge=o.bind(null,this),this._updateLeds=i.bind(null,this),this._updateCenterShadow=a.bind(null,this),this._updateButtonsState=s.bind(null,this),this._createButtons=r.bind(null,this),this.shadowRoot.getElementById("gauge-container").addEventListener("click",()=>function(t){if(!t.config.entity||!t._hass)return;const e=new Event("hass-more-info",{bubbles:!0,composed:!0});e.detail={entityId:t.config.entity},t.dispatchEvent(e)}(this)),this._updateLeds(0,this.ledsCount),function(t){const e=t.shadowRoot.querySelector(".gauge-card"),n=t.config.entity,o=t.config.name||n;e.setAttribute("role","slider"),e.setAttribute("aria-valuemin",t.config.min||0),e.setAttribute("aria-valuemax",t.config.max||100),e.setAttribute("aria-label",`${o} gauge`);const i=n=>{e.setAttribute("aria-valuenow",n),e.setAttribute("aria-valuetext",`${n}${t.config.unit?" "+t.config.unit:""}`)},a=t.shadowRoot.querySelector(".value");a&&(new MutationObserver(()=>{i(parseFloat(a.textContent))}).observe(a,{childList:!0}),i(parseFloat(a.textContent||"0")))}(this),async function(t){if(!t.config.show_trend||!t._hass||!t.config.entity)return;const e=t.config.entity,n=new Date,o=new Date;o.setHours(n.getHours()-24);try{const i=await t._hass.callWS({type:"history/history_during_period",entity_ids:[e],start_time:o.toISOString(),end_time:n.toISOString(),minimal_response:!0});if(!i||!i[0]||0===i[0].length)return;const a=i[0],r=parseFloat(a[a.length-1].state),s=parseFloat(a[0].state),c=r-s,l=0!==s?c/s*100:0,d=document.createElement("div");d.className="trend-indicator";const u=document.createElement("span");u.className="trend-arrow";const g=document.createElement("span");g.className="trend-value",c>0?(u.textContent="‚Üë",u.style.color="#4caf50"):c<0?(u.textContent="‚Üì",u.style.color="#f44336"):(u.textContent="‚Üí",u.style.color="#ffeb3b"),g.textContent=`${Math.abs(l).toFixed(1)}%`,d.appendChild(u),d.appendChild(g),t.shadowRoot.querySelector(".gauge-card").appendChild(d)}catch(t){console.error("Erreur lors de la r√©cup√©ration de l'historique:",t)}}(this),function(t){if(!t.config.markers&&!t.config.zones)return;const e=t.shadowRoot.querySelector(".gauge");if(!e)return;const n=t.config.min||0,o=(t.config.max||100)-n,i=t.config.gauge_size||200;t.config.markers&&t.config.markers.forEach(t=>{const a=(t.value-n)/o*100/100*360,r=document.createElement("div");if(r.className="marker",r.style.cssText=`\n        position: absolute;\n        width: 4px;\n        height: 12px;\n        background: ${t.color||"#fff"};\n        border-radius: 2px;\n        transform: rotate(${a-90}deg) translateX(${i/2-5}px);\n        transform-origin: center center;\n        z-index: 2;\n        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\n      `,t.label){const n=document.createElement("div");n.className="marker-label",n.textContent=t.label,n.style.cssText=`\n          position: absolute;\n          font-size: 10px;\n          color: ${t.color||"#fff"};\n          transform: rotate(${a-90}deg) translateX(${i/2+15}px) rotate(${90-a}deg);\n          transform-origin: center center;\n          z-index: 2;\n          text-shadow: 0 0 3px rgba(0, 0, 0, 0.7);\n        `,e.appendChild(n)}e.appendChild(r)}),t.config.zones&&t.config.zones.forEach(t=>{const a=(t.from-n)/o*100/100*360,r=(t.to-n)/o*100/100*360,s=r-a,c="http://www.w3.org/2000/svg",l=document.createElementNS(c,"svg");l.setAttribute("width",`${i+20}`),l.setAttribute("height",`${i+20}`),l.style.cssText="\n        position: absolute;\n        top: -10px;\n        left: -10px;\n        z-index: 1;\n        pointer-events: none;\n      ";const d=document.createElementNS(c,"path"),u=i/2+5,g=(i+20)/2,f=`M ${g+u*Math.cos((a-90)*Math.PI/180)},${g+u*Math.sin((a-90)*Math.PI/180)} A ${u},${u} 0 ${s>180?1:0},1 ${g+u*Math.cos((r-90)*Math.PI/180)},${g+u*Math.sin((r-90)*Math.PI/180)}`;d.setAttribute("d",f),d.setAttribute("fill","none"),d.setAttribute("stroke",t.color||"#fff"),d.setAttribute("stroke-width","4"),d.setAttribute("opacity",t.opacity||"0.5"),l.appendChild(d),e.appendChild(l)})}(this),function(t){if(!t.config.power_save_mode)return;const e={root:null,rootMargin:"0px",threshold:t.config.power_save_threshold/100};t.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{t.isVisible=e.isIntersecting,t.isVisible&&t._hass&&t._updateGauge&&t._updateGauge()})},e),t.intersectionObserver.observe(t)}(this)}set hass(t){this._hass=t,!this.buttonsInitialized&&this.shadowRoot&&(this._createButtons(),this.buttonsInitialized=!0),this.config.power_save_mode&&!this.isVisible||(this.config.debounce_updates?(this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>{this._updateGauge()},this.config.update_interval)):this._updateGauge())}}console.info("%c CUSTOM-GAUGE-CARD \n%c Version 1.0.4 ","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray"),customElements.define("custom-gauge-card",c)}();
